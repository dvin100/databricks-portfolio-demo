resources:
  database_instances:
    # TODO (optional): Uncomment the database resource below to deploy the app with a database
    lakebase_portfolio:
      # NOTE: customize the Lakebase instance name here, if desired
      ### TODO: CHANGE THE DATABASE NAME BELOW, same as above
      name: ${var.lakebase_portfolio_name}
      capacity: CU_2
  apps:
    databricks_portfolio_apps:
      # NOTE: customize the app name here, if desired
      ### TODO: CHANGE THE APP NAME BELOW
      name: ${var.databricks_app_name}
      description: "Agentic Chat application for Foundation Models, Agent Bricks, and custom code agents"
      source_code_path: ../src/.
      resources:
        - name: serving-endpoint
          description: "Databricks serving endpoint name for the AI agent"
          # NOTE: If chatting with an Agent Bricks Multi-Agent Supervisor (https://docs.databricks.com/aws/en/generative-ai/agent-bricks/multi-agent-supervisor),
          # you need to additionally grant the app service principal the `CAN_QUERY` permission on the
          # underlying agent(s) that the MAS orchestrates. You can do this by adding those
          # agent serving endpoints as additional resources here.
          serving_endpoint:
            name: ${var.serving_endpoint_name}
            permission: CAN_QUERY
        # TODO (optional): Uncomment the database resource below to bind the app to the deployed database instance
        # and to enable persistent chat history
        - name: database
          description: "Lakebase database instance for the chat app"
          database:
            database_name: databricks_postgres
            instance_name: ${resources.database_instances.lakebase_portfolio.name}
            permission: CAN_CONNECT_AND_CREATE